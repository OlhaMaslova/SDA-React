---
kind: pipeline
name: lint

steps:
- name: lint
  image: miki725/pre-commit

trigger:
  ref:
    - refs/heads/master
    - refs/pull/*/head

---
kind: pipeline
name: deploy

steps:
- name: deploy
  image: docker/compose:1.24.1
  environment:
    COMPOSE_PROJECT_NAME: sda-react
    MOUNT_PATH: /tmp/app
    API_SITE_URL:
      from_secret:  API_SITE_URL
    INSTAGRAM_SECRET:
      from_secret:  INSTAGRAM_SECRET
  volumes:
    - name: docker_sock
      path: /var/run/docker.sock
  commands:
    - docker-compose build --pull
    - docker-compose up -d
    - timeout -t 10 docker-compose logs -f app || true

trigger:
  ref:
    - refs/heads/master

volumes:
  - name: docker_sock
    host:
      path: /var/run/docker.sock

---
kind: secret
name: API_SITE_URL
get:
  path: drone/data/firstrussianny/SDA-React
  name: API_SITE_URL

---
kind: secret
name: INSTAGRAM_SECRET
get:
  path: drone/data/firstrussianny/SDA-React
  name: INSTAGRAM_SECRET

---
kind: signature
hmac: 4409d6b1aa8795e33968fb334fc91701659cb679b78a9a057854687e9deb546e

...
